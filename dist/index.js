"use strict";var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var import_dotenv=require("dotenv");var import_fastify=__toESM(require("fastify"));var import_jwt=__toESM(require("@fastify/jwt"));var index=async(_request,reply)=>reply.send({links:{login:"/auth/login",register:"/auth/register",refresh:"/auth/refresh"}});var authRouter=async app2=>{app2.get("/",index)};var import_pino=require("pino");var logger=(0,import_pino.pino)({name:"ppdb-sman3palu",level:"info",transport:{target:"pino-pretty",options:{colorize:true,translateTime:"SYS:standard",ignore:"pid,hostname"}}});if(process.env.NODE_ENV==="development"){(0,import_dotenv.config)()}var serverPort=parseInt(process.env.PORT??"3000",10)??3e3;var app=(0,import_fastify.default)({trustProxy:true,logger:process.env.NODE_ENV==="development"?logger:false});async function bootstrap(){await app.register(import_jwt.default,{secret:process.env.JWT_SECRET??"this-is-default-secret",sign:{iss:"ppdb.sman3palu.sch.id"},verify:{allowedIss:["ppdb.sman3palu.sch.id"]}});await app.register(authRouter,{prefix:"/auth"});app.listen({port:serverPort,host:"0.0.0.0"},err=>{if(err){app.log.error(err);process.exit(1)}})}void bootstrap();
